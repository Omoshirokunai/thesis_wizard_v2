<!DOCTYPE html>
<html>
<head>
    <title>LLM Interaction</title>
    <style>
        .form-group {
            margin-bottom: 1rem;
        }
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
        }
        .form-group input {
            width: 100%;
            padding: 0.5rem;
            margin-bottom: 0.5rem;
        }
        .stats-box {
            background: #f5f5f5;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 4px;
        }
        .conversation-list {
            list-style: none;
            padding: 0;
        }
        .user-message, .model-message {
            padding: 0.5rem;
            margin: 0.5rem 0;
            border-radius: 4px;
        }
        .user-message {
            background: #e3f2fd;
        }
        .model-message {
            background: #f5f5f5;
        }
        .timestamp {
            font-size: 0.8rem;
            color: #666;
        }
        .model-info {
            font-size: 0.8rem;
            color: #666;
            margin-top: 0.5rem;
        }
        .pdf-section {
            margin: 2rem 0;
            padding: 1rem;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .rag-results {
            margin: 1rem 0;
            padding: 1rem;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .rag-results li {
            margin-bottom: 1rem;
            padding: 0.5rem;
            background: #f8f9fa;
        }
        .source {
            font-weight: bold;
        }
        .relevance {
            color: #666;
            font-size: 0.9rem;
        }
        .snippet {
            margin-top: 0.5rem;
        }
    </style>
</head>
<body>
    <h1>Thesis Copilot</h1>
    <!-- model selection -->
    <form method="POST" action="/update_settings">
        <label for="model">Select Model:</label>
        <select name="model">
            {% for model in models %}
                <option value="{{ model }}" {% if model == selected_model %}selected{% endif %}>
                    {{ model }}
                </option>
            {% endfor %}
        </select>
        <button type="submit">Update Settings</button>
    </form>


    <div class="input-section">
        <!-- Project Context -->
        <form method="POST" action="{{ url_for('update_project') }}">
            <div class="form-group">
                <label for="project_title">Project Title:</label>
                <input type="text" name="project_title" id="project_title" value="{{ project_context.title }}">
            </div>

            <div class="form-group">
                <label for="keywords">Keywords (comma-separated):</label>
                <input type="text" name="keywords" id="keywords" value="{{ ','.join(project_context.keywords) }}">
            </div>

            <div class="form-group">
                <label for="section_context">Section:</label>
                <select name="section_context" id="section_context">
                    <option value="introduction" {% if project_context.section == 'introduction' %}selected{% endif %}>Introduction</option>
                    <option value="literature_review" {% if project_context.section == 'literature_review' %}selected{% endif %}>Literature Review</option>
                    <option value="methodology" {% if project_context.section == 'methodology' %}selected{% endif %}>Methodology</option>
                    <option value="results" {% if project_context.section == 'results' %}selected{% endif %}>Results</option>
                    <option value="discussion" {% if project_context.section == 'discussion' %}selected{% endif %}>Discussion</option>
                    <option value="conclusion" {% if project_context.section == 'conclusion' %}selected{% endif %}>Conclusion</option>
                </select>
            </div>

            <button type="submit">Update Project</button>
        </form>

      <!-- Query Input -->
    <form method="POST">
        <div class="form-group">
            <label for="query">Query:</label>
            <input type="text" name="query" id="query" placeholder="Enter your query">
            <button type="submit">Search</button>
        </div>
    </form>
</div>


<!-- Statistics Section -->
<div class="stats-box">
    <h3>Conversation Statistics</h3>
    {% if stats %}
    <ul>
        <li>Total Exchanges: {{ stats.total_exchanges }}</li>
        <li>User Words: {{ stats.user_words }} ({{ stats.user_percentage }}%)</li>
        <li>Model Words: {{ stats.model_words }} ({{ stats.model_percentage }}%)</li>
    </ul>
    {% endif %}
</div>
<!-- RAG section -->
{% if rag_results %}
<div class="rag-results">
    <h3>Relevant Sources</h3>
    <ul>
    {% for result in rag_results %}
        <li>
            <div class="source">{{ result.source }}</div>
            <div class="relevance">Relevance: {{ "%.2f"|format(result.score) }}</div>
            <div class="snippet">{{ result.text[:200] }}...</div>
        </li>
    {% endfor %}
    </ul>
</div>
{% endif %}

{% if response %}
<div class="response-section">
    <h3>Response</h3>
    <div class="model-response">{{ response }}</div>
</div>
{% endif %}

<!-- PDF Processing Section -->
<div class="pdf-section">
    <h3>Knowledge Base Management</h3>
    <form method="POST" action="/set_pdf_directory">
        <div class="form-group">
            <label for="pdf_directory">PDF Directory:</label>
            <input type="text" name="pdf_directory" id="pdf_directory"
                   placeholder="Enter path to PDF directory">
            <button type="submit">Process PDFs</button>
        </div>
    </form>

    {% if pdf_info %}
    <div class="pdf-info">
        <h4>Loaded Documents:</h4>
        <ul>
            {% for title, info in pdf_info.items() %}
            <li>{{ title }} ({{ info.chunks }} chunks)</li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}
</div>
<!-- Conversation History -->
<div class="history-section">
    <h3>Conversation History</h3>
    {% if history and history.completions %}
    <ul class="conversation-list">
        {% for entry in history.completions %}
        <li class="{{ entry.type }}-message">
            <span class="timestamp">{{ entry.timestamp }}</span>
            <div class="content">{{ entry.content }}</div>
            {% if entry.type == 'model' %}
            <div class="model-info">
                <small>Model: {{ entry.model.name }}</small>
            </div>
            {% endif %}
        </li>
        {% endfor %}
    </ul>
    {% else %}
    <p>No conversation history yet.</p>
    {% endif %}
</div>

</body>
</html>
